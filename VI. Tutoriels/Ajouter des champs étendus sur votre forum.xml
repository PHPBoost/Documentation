<?xml version="1.0" encoding="iso-8859-1"?>
<wiki_article>
  <wiki_articles_fields>
    <wiki_id>193</wiki_id>
    <wiki_id_contents>954</wiki_id_contents>
    <wiki_title>Ajouter des champs étendus sur votre forum</wiki_title>
    <wiki_encoded_title>ajouter-des-champs-etendus-sur-votre-forum</wiki_encoded_title>
    <wiki_hits>485</wiki_hits>
    <wiki_id_cat>54</wiki_id_cat>
    <wiki_is_cat>0</wiki_is_cat>
    <wiki_defined_status>0</wiki_defined_status>
    <wiki_undefined_status></wiki_undefined_status>
    <wiki_redirect>0</wiki_redirect>
    <wiki_auth></wiki_auth>
  </wiki_articles_fields>
  <wiki_contents_fields>
    <wiki_con_id_contents>954</wiki_con_id_contents>
    <wiki_con_id_article>193</wiki_con_id_article>
    <wiki_menu><ol class="wiki_list_1"><li><a href="#paragraph_introduction">Introduction</a></li><li><a href="#paragraph_creer-le-champ-etendu">Créer le champ étendu</a></li><li><a href="#paragraph_l-image">L' image</a></li><li><a href="#paragraph_recuperation-du-champ-etendu">Récupération du champ étendu</a></li><li><a href="#paragraph_l-affichage">L'affichage</a></li><li><a href="#paragraph_resultat">Résultat</a></li><li><a href="#paragraph_ca-ne-fonctionne-pas">Ca ne fonctionne pas !</a></li></ol></wiki_menu>
    <wiki_activ>1</wiki_activ>
    <wiki_user_id>4652</wiki_user_id>
    <wiki_user_ip>31.32.177.198</wiki_user_ip>
    <wiki_timestamp>1382998766</wiki_timestamp>
    <wiki_content>-- Introduction --

Le présent tutoriel a pour but de vous aider à ajouter simplement des champs personnalisés dans les messages du forum.
Nous vous montrerons la procédure pas à pas simplement, en mettant en place un champ Facebook.
A la fin de cet article, vous devriez obtenir ce résultat :
[img]/upload/champsupp3.jpg[/img]


-- Créer le champ étendu --

Tout d'abord, il va falloir créer un champ étendu. Rendez-vous donc dans le panneau d'administration, menu '[b]Utilisateurs[/b]', '[b]Champs étendus[/b]' =&gt; '[b]Ajouter[/b]'
Remplissez le champ comme vous le souhaitez. Pour notre champ Facebook, j'ai rempli ainsi :
 [img]/upload/champsupp1.jpg[/img]
Ensuite, n'oubliez pas de valider (;

-- L' image --

Dans mon exemple, j'ai utilisé cette image :  [img]/upload/user_fb.png[/img]. C'est elle qui sera utilisée pour permettre aux usagers de cliquer et atterrir sur la page Facebook de l'auteur du message.
Vous pouvez bien entendu la récupérer, pour ce un petit clic droit 'Enregistrer l'image sous'.

Je l'ai appelée '[b]user_fb.png[/b]'. Son nom nous sera important pour la suite. Nous allons maintenant la placer de manière à ce qu'elle soit utilisable par le module forum.
Copiez donc votre image, et collez la dans le dossier '[b]templates/nom_de_votre_theme/images/french[/b]'
[style=notice]Si vous souhaiter utiliser votre site en anglais, répétez l'opération avec le dossier '[b]english[/b]'[/style]


-- Récupération du champ étendu --

Avant de pouvoir afficher notre petit bouton, nous allons déjà en récupérer le contenu. Pour cela, ouvrez le fichier '[b]forum/topic.php[/b]'.
Allez à la ligne 205 (oui, le gros pavé (; ). Toute cette partie qui peut paraître très abstraite pour des gens normaux est chargée de questionner la base de données. Elle récupère entre autres les messages du sujet, mais aussi la signature, l'avatar du membre qui les ont postés.
Ajoutons donc le code qui nous permettra d'obtenir notre champ :

Cherchez dans cette ligne le code suivant :
[code=php]ext_field.user_sign,[/code]

A la suite, ajoutez-y simplement :
[code=php] ext_field.f_facebook,[/code]
[style=success]Pour les curieux :
ext_field : Alias donné à la table '[b]member_extended_fields[/b]' dans la requête SQL
f_facebook : nom du champ étendu précédé de '[b]f_[/b]', utilisé par PHPBoost pour gérer les champs personnalisés[/style]

Ensuite, passons à la ligne 376 : 
[code=php]$Template-&gt;assign_block_vars('msg', array([/code]

Toute cette partie ( jusqu'à la ligne 418) est très importante : Elle passe les variables PHP récupérées dans la base de données jusqu'au template (fichier .TPL). Nous allons donc en profiter pour passer également notre champ facebook :

En dessous de la ligne 397 (qui commence par '[b]'USER_WEB' =&gt; (!empty($row[[/b]' ), ajoutez ceci :
[code=php]'USER_FB' =&gt; (!empty($row['f_facebook'])) ? '&lt;a href="'. $row['f_facebook'] . '"&gt;&lt;img src="../templates/' . get_utheme() . '/images/' . get_ulang() . '/user_fb.png" /&gt;&lt;/a&gt;' : '',[/code]

[style=success]Pour les téméraires :
[b]USER_FB[/b] sera le nom de la variable dans le template. A noter que cette variable sera stockée dans le block 'msg', qui passera en boucle chaque message du sujet.
[b]$row['f_facebook'][/b] contient le champ facebook de l'auteur du message, récupéré dans la BDD.
Le code teste si le champ étendu en question est rempli ou pas. S'il l'est, alors on affecte à la variable 'USER_FB' le lien et l'image. Sinon, une chaîne vide lui est retournée.
Remarquez également la présence du nom de notre image (;
[/style]

Sauvegardez votre fichier et passons à la dernière étape.


-- L'affichage --

Jusqu'à présent, nous avons préparé et récupéré notre champ étendu. Nous allons pouvoir maintenant l'afficher sur chaque message du forum.
Pour ce, ouvrez le fichier '[b]forum\templates\forum_topic.tpl[/b]' et allez à la ligne 296 :
[code=tpl]{msg.USER_PM} {msg.USER_MAIL} {msg.USER_MSN} {msg.USER_YAHOO} {msg.USER_WEB}[/code]

Il nous suffit à présent d'insérer notre variable. Ajoutez donc à la suite :
[code=tpl] {msg.USER_FB}[/code]

Sauvegardez votre fichier.


-- Résultat --

En naviguant dans les messages de votre forum, vous devriez maintenant voir apparaître la petite icône Facebook comme la mienne :
[img]/upload/champsupp3.jpg[/img]


-- Ca ne fonctionne pas ! --

Si ça ne fonctionne pas, pas de panique.
Assurez-vous d'avoir :
[list]
	[*] Bien rempli le champ étendu dans votre profil : 
 [img]/upload/champsupp2.jpg[/img]
	[*] Vidé le cache après avoir effectué toutes les manipulations
	[*] Bien effectué toutes les opérations décrites ci-dessus
[/list]</wiki_content>
  </wiki_contents_fields>
</wiki_article>